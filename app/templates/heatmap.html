{% extends "bootstrap/base.html" %}

{% block title %}
Heatmap
{% endblock %}

{% block styles %}
{{super()}}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.8/semantic.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
<script src="https://rawgit.com/Leaflet/Leaflet.heat/gh-pages/dist/leaflet-heat.js"></script>

{% endblock %}
<style>
#mapid {
height: 180px;
}
</style>

{% block content %}
<div id="mapid" style="width: 1600px; height: 1400px; position: relative; outline: none;"></div>

<script>
var markList = [];
var loc_data = [];
var testData = {};
var data = [];

send();
function send() {
	var person = {
		name: $("#test").val(),
	}
	$.ajax({
		url: '/getLocations',
		type: 'post',
		dataType: 'json',
		success: function (data) {
			for(var i =0;i<data.marks.length;i++){
				//console.log(i);
				//console.log("x: ",data.marks[i][0],"y: ",data.marks[i][1]);
				var this_loc = L.latLng(data.marks[i][1],data.marks[i][0]);
				heat.addLatLng(this_loc);
				//loc_data.push(this_loc);
				console.log(this_loc);
				//markList[i] = L.marker([data.marks[i][1],data.marks[i][0]]).addTo(mymap);
				//markList[i].bindPopup("<form class='form-inline'><input class='form-control form-control-sm' type='text' placeholder='Where is here?'><button type='submit' class='btn btn-primary'>Confirm</button></form>").openPopup();
			}
		},
	});
}

var mymap = L.map('mapid').setView([24.7872632,120.9973644], 13);
//var marker = L.marker([51.5, -0.09]).addTo(mymap);

L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
maxZoom: 18,
attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
id: 'mapbox.streets'
}).addTo(mymap);

var heat = L.heatLayer(data, {
            radius: 10,
            blur: 5
        }).addTo(mymap);

</script>

{% endblock %}
